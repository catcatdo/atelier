{% extends 'base.html' %}
{% load content_tags %}

{% block title %}{{ post.title }} — Atelier des Poupées{% endblock %}

{% block content %}
<article class="max-w-4xl mx-auto px-4 py-12">
    <!-- Breadcrumb -->
    <nav class="mb-8 text-sm text-charcoal/40">
        <a href="{% url 'home' %}" class="hover:text-gold transition">Home</a>
        <span class="mx-2">&rsaquo;</span>
        <a href="{% url 'post_list' %}" class="hover:text-gold transition">Journal</a>
        <span class="mx-2">&rsaquo;</span>
        <span class="text-charcoal/70">{{ post.title }}</span>
    </nav>

    <!-- Header -->
    <header class="text-center mb-10">
        <p class="text-gold tracking-[0.2em] text-xs font-heading mb-3">
            {{ post.created_at|date:"d F Y" }}
        </p>
        <h1 class="font-heading text-3xl sm:text-4xl text-charcoal tracking-wide mb-4">
            {{ post.title }}
        </h1>
        <p class="text-charcoal/40 text-sm">By {{ post.author.username }}</p>
        <div class="w-20 h-0.5 bg-gold mx-auto mt-6"></div>
    </header>

    <!-- Featured Image -->
    {% if post.image %}
    <div class="mb-10 rounded-lg overflow-hidden border-double border-4 border-charcoal/10 shadow-lg">
        <img src="{{ post.image.url }}" alt="{{ post.title }}" class="w-full">
    </div>
    {% endif %}

    <!-- Content -->
    <div class="text-charcoal/75 leading-relaxed text-lg space-y-6">
        {{ post.content|linebreaks }}
    </div>

    <!-- Related Product -->
    {% if post.related_product %}
    <div class="mt-12 p-6 bg-white rounded-lg border-double border-4 border-gold/20 shadow-md">
        <p class="font-heading text-gold tracking-[0.2em] text-xs mb-4">FEATURED IN THIS POST</p>
        <div class="flex flex-col sm:flex-row gap-6 items-start">
            {% if post.related_product.image %}
            <div class="w-full sm:w-32 h-32 rounded overflow-hidden flex-shrink-0 border border-charcoal/10">
                <img src="{{ post.related_product.image.url }}" alt="{{ post.related_product.name }}"
                     class="w-full h-full object-cover">
            </div>
            {% endif %}
            <div class="flex-1">
                <h3 class="font-heading text-lg text-charcoal tracking-wide">{{ post.related_product.name }}</h3>
                <p class="text-leather font-semibold mt-1">{{ post.related_product.price|krw }}</p>
                <p class="text-charcoal/50 text-sm mt-2">{{ post.related_product.description|truncatewords:20 }}</p>
                <a href="{% url 'product_detail' post.related_product.slug %}"
                   class="inline-block mt-3 bg-leather text-parchment px-6 py-2 text-xs font-heading tracking-[0.15em] hover:bg-leather-light transition rounded">
                    VIEW PRODUCT
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Comments Section -->
    <div class="mt-16">
        <div class="border-t border-charcoal/10 pt-10">
            <h2 class="font-heading text-xl text-charcoal tracking-wide mb-8">
                COMMENTS ({{ comments|length }})
            </h2>

            {% if comments %}
            <div class="space-y-6">
                {% for comment in comments %}
                <div class="bg-white p-6 rounded-lg border border-charcoal/10 shadow-sm">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-semibold text-charcoal text-sm">{{ comment.author.username }}</span>
                        <span class="text-xs text-charcoal/30">{{ comment.created_at|date:"d M Y, H:i" }}</span>
                    </div>
                    <p class="text-charcoal/65 leading-relaxed">{{ comment.content }}</p>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-charcoal/35 font-display italic">No comments yet. Be the first to share your thoughts.</p>
            {% endif %}

            <!-- Comment Form -->
            <div class="mt-10">
                {% if user.is_authenticated %}
                <h3 class="font-heading text-base text-charcoal tracking-wide mb-4">LEAVE A COMMENT</h3>
                <form method="post">
                    {% csrf_token %}
                    <textarea name="content"
                              placeholder="Share your thoughts..."
                              rows="4"
                              required
                              class="w-full p-4 bg-white border border-charcoal/15 rounded-lg focus:border-gold focus:ring-1 focus:ring-gold outline-none transition resize-none text-charcoal"></textarea>
                    <button type="submit"
                            class="mt-3 bg-leather text-parchment px-6 py-2.5 font-heading tracking-[0.15em] text-xs hover:bg-leather-light transition rounded shadow">
                        POST COMMENT
                    </button>
                </form>
                {% else %}
                <div class="bg-white p-6 rounded-lg border-double border-4 border-charcoal/10 text-center">
                    <p class="text-charcoal/50 mb-3">Sign in to join the conversation.</p>
                    <a href="{% url 'login' %}" class="text-gold font-heading tracking-[0.15em] text-sm hover:underline">SIGN IN &rarr;</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</article>
{% endblock %}
